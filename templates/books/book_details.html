{% extends "base.html" %}
{% load crispy_forms_tags %}


{% block main_content %}
    
    <link rel="stylesheet" type="text/css" href="https://bootswatch.com/5/journal/bootstrap.min.css">
    
    <br>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h1 class="text-center">{{ book.title}}</h1>

                {% csrf_token %}
                <form method="get" action="{% url "book details" pk=book.pk %}">
                    
                    <img src="{{ book.cover_image }}" alt="Cover Image">
                <br>
             
                    <ul type="none">
                        
                        <li class="align-left descname"><h4 class="data-decor">By: {{ book.author }}</h4></li>
               
                        <li><h4>Published in: {{ book.year_published }}</h4></li>
                        <li><h4>
                            {% if book.category.all|length == 1 %}
                            Category: {{ book.category.name }}
                            {% else %}
                            Categories:
                                {% for category in book.categories.all %}
                                {{ category.name }}
                                    {% if not forloop.last %}
                                        / 
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </h4>
                        </li>
                        <li class="description"><h4>Summary: {{ book.description }}</h4></li>
                        <li><h6 class="grey">Added by: {% if not book.added_by %}Anonymous
                        {% else %}<a href="{% url 'bookie profile' pk=book.added_by.pk %}">{{ book.added_by }}</a>
                        {% endif %}</h6></li>
                        
                    </ul>                
                
                </form>
            
            {# FIELDS FOR AUTHENTICATED USERS #}
            
            {% if request.user.is_authenticated  %}
        
                {% if book not in request.user.profile.want_to_read.all and book not in request.user.profile.have_read.all%}
                    
                <form action="{% url 'add to wishlist' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="book_id" value="{{ book.pk }}">
                <button class="btn btn-primary" type="submit">
                    I want to read this book</button>
                </form>
                {% endif %}
            
                {% if book not in request.user.profile.have_read.all %}
                    
                <form action="{% url 'add to already read' %}" method="post">
                {% csrf_token %}
                    
                <input type="hidden" name="book_id" value="{{ book.pk }}">
                <button class="btn" type="submit">
                    I have read this book</button>
            
                </form>
                {% endif %}
                           
            {% endif %}
           
            
            {# CRUD OPERATIONS ONLY FOR SUPERUSER AND THE ONE, WHO ADDED THE BOOK #}
                <br>
                <br>
                {% if request.user.is_superuser or book.added_by == request.user %}
                    <a class="btn btn-primary container row justify-content-center" href="{% url 'update book' pk=book.pk %}">Edit Book</a>

                    <form method="post" action="{% url 'delete book' pk=object.pk %}">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirmDelete();"
                    class="btn container row">Delete Book</button>
                    </form>

                {% endif %}


            </div>
        </div>
    </div>

    <script>
    function confirmDelete(){
        return confirm("Are you sure you want to delete this book?")
        
    }
    
    </script>

{% endblock %}
